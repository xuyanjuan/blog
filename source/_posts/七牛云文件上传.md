---
title: 七牛云文件上传

date: 2018/6/18 22:15:20

updated: 2018/6/18 22:15:20

categories:
 - python
 
tags:
 - 文件上传
---
![20200826102636292.jpg](https://i.loli.net/2021/02/01/mGWJefdCR9EaIlk.jpg)

# 前期准备
**注册七牛云**
>https://www.qiniu.com/

**拿到AK和SK 个人中心-密钥管理**

![1206c4a7db1fa0b80c6cfc1b67db431.png](https://i.loli.net/2021/03/19/URmvF5TLbgXnlSY.png)
**新建云存储空间和域名**
![58f5d2993e05ff41afc9193d9828fa3.png](https://i.loli.net/2021/03/19/WX3UKgn1rwq6JSM.png)

域名创建方法https://developer.qiniu.com/kodo/kb/5859/domain-name-to-access-the-storage-space

# 使用python获取上传使用的token值
**安装七牛云**
>pip install qiniu==7.2.6

**获取token,这里是使用的工用方法，在app下创建qiniu.py文件**
```
from qiniu import Auth

def qiniu_token():
    # 定义密钥
    qn = Auth('AK', 'SK')
    # 指定上传空间, 返回token值
    token = qn.upload_token('空间名称')
    return token
```
**在views.py里使用qiniu_token**
```
from django.views import View
from django.http import JsonResponse
from app.qiniu import qiniu_token


class UpTokenView(View):

    def get(self, request):
        """
        七牛云token接口
        """
        return JsonResponse({'token': qiniu_token()})

```
**url.py**
```
from django.urls import path
from .view import *

urlpatterns = [
    path('uptoken/', UpTokenView.as_view()),  # 获取七牛云上传凭证
]

```
# 在vue里面写入的内容
```
<template>
    <div>
        <p style="text-align: center;">七牛云上传：<input type="file" @change="upload_qiniu"></p>
        <p style="text-align: center;"><img :src="img_url" alt="" style="width: 200px; height: 200px; border-radius:50%;"></p>
    </div>
</template>

<script>
import axios from 'axios'
export default {
    data() {
        return {
            img_url: '',
            // 七牛去上传凭证
            uptoken: ''
        }
    },
    methods: {
        // 获取uptoken
        get_uptoken() {
            axios({
                url: 'http://127.0.0.1:8000/day01/uptoken/',
                method: 'get'
            }).then(res=>{
                this.uptoken = res.data.token
            })
        },
        // 七牛云上传
        upload_qiniu(e) {
            // 获取文件对象
            let file = e.target.files[0]
            // 声明参数
            let form_data = new FormData()
            // 将上传凭证添加参数
            form_data.append('token', this.uptoken)
            // 添加图片
            form_data.append('file', file)
            // 定制化axios  不携带cookie上传
            const axios_qiniu = axios.create({withCredentials:false})
            // 发送请求
            axios_qiniu({
                method: 'post',
                url: 'http://up-z1.qiniu.com/',
                data: form_data,
                tiemout: 30000,

            }).then(res=>{
                console.log(res)
                this.img_url = 'http://media.dongha iming.cn/' + res.data.key
            })
        }
    },
    mounted() {
        this.get_uptoken()
    }
}
</script>

```